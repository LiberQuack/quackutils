import { useContext, useEffect, useState } from "haunted/lib/core";
import { StripeContext } from "./stripe-context";
import { component } from "haunted";
import { css } from "../../../util/css";
import { fmt } from "./stripe-form";
import { html } from "lit";
function defineComponent(tagName, func) {
    css `${tagName} {display: block}`;
    customElements.define(tagName, component(func, { useShadowDOM: false }));
    return func;
}
function defineStripeInputElm(tagName, type, opts) {
    const StripeInputElm = function () {
        const stripeContext = useContext(StripeContext);
        const [stripeElm, setStripeElm] = useState(null);
        useEffect(() => {
            if (stripeContext) {
                setStripeElm(buildStripeElement(this, stripeContext, type, opts));
            }
        }, [stripeContext]);
        return stripeElm;
    };
    return defineComponent(tagName, StripeInputElm);
}
function buildStripeElement(host, stripeRef, type, opts) {
    const stripeElm = stripeRef.stripeElements.create(type, opts);
    const container = document.createElement("div");
    stripeElm.mount(container);
    stripeElm.on("ready", (e) => {
        let onElementReadyEvent = new CustomEvent("elementready", { detail: e, bubbles: true });
        host.dispatchEvent(onElementReadyEvent);
    });
    return container;
}
export const StripeCard = defineStripeInputElm("stripe-card", "card");
export const StripeCardNumber = defineStripeInputElm("stripe-card-number", "cardNumber");
export const StripeCardCvc = defineStripeInputElm("stripe-card-cvc", "cardCvc");
export const StripeCardExpiry = defineStripeInputElm("stripe-card-expiry", "cardExpiry");
export const StripeSubmitErr = defineComponent("stripe-submit-error", function () {
    const stripeContext = useContext(StripeContext);
    const err = stripeContext?.useSubmit?.err;
    if (!err) {
        return undefined;
    }
    return html `${fmt.err(err)}`;
});
export const StripeSubmit = defineComponent("stripe-submit", function () {
    const stripeContext = useContext(StripeContext);
    const submitCb = stripeContext?.useSubmit?.run;
    useEffect(() => {
        if (submitCb) {
            this.addEventListener("click", submitCb);
            return () => this.removeEventListener("click", submitCb);
        }
    }, [submitCb]);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaXBlLWVsZW1lbnRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3VpL2NvbXBvbmVudHMvcGF5bWVudHMvc3RyaXBlL3N0cmlwZS1lbGVtZW50cy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFDakUsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLGtCQUFrQixDQUFDO0FBQy9DLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxTQUFTLENBQUM7QUFDbEMsT0FBTyxFQUFDLEdBQUcsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBRXRDLE9BQU8sRUFBQyxHQUFHLEVBQXVCLE1BQU0sZUFBZSxDQUFDO0FBRXhELE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxLQUFLLENBQUM7QUFJekIsU0FBUyxlQUFlLENBQUMsT0FBZSxFQUFFLElBQTZCO0lBQ25FLEdBQUcsQ0FBQSxHQUFHLE9BQU8sbUJBQW1CLENBQUE7SUFDaEMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLElBQUksRUFBRSxFQUFDLFlBQVksRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkUsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQztBQUVELFNBQVMsb0JBQW9CLENBQUMsT0FBZSxFQUFFLElBQWUsRUFBRSxJQUFVO0lBRXRFLE1BQU0sY0FBYyxHQUE0QjtRQUM1QyxNQUFNLGFBQWEsR0FBRyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDaEQsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxRQUFRLENBQUMsSUFBNkIsQ0FBQyxDQUFDO1FBRTFFLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDWCxJQUFJLGFBQWEsRUFBRTtnQkFDZixZQUFZLENBQUMsa0JBQWtCLENBQUMsSUFB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